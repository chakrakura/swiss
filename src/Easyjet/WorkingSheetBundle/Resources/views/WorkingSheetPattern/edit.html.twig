{% extends '@EasyjetWorkingSheet/Base/structure.html.twig' %}
{% import "@EasyjetSwissinsideCore/Base/macros.html.twig" as macros %}

{% block container -%}

    <div id="content">
        <div id="content-header">
            <h1 id="titre_help">Working sheet pattern</h1>
            <div id="description_help">Here you are able to update sheet pattern. Just fill the form in order to create your entry.</div>
        </div>
        
        <div class="row">
            <div class="col-xs-12">
                {{ macros.wizz() }}
            </div>
        </div>
        
        <div class="row">

            <div class="col-xs-12">
                <div class="widget-box">
                    <div class="widget-title">
                        <span class="icon">
                            <i class="icon-th"></i>
                        </span>
                        <h5>Your working sheet pattern</h5>
                    </div>
                    <div class="widget-content nopadding">
                        {{ form_start(edit_form, {'attr': {'class': 'form-horizontal', "id" : "pattern-form"}} ) }}
                        <table width="100%" class="table table-bordered table-striped table-hover data-table" id="call-types-list">
                        <thead>
                            <tr>
                                <th>Day of the week</th>
                                <th colspan="2">Morning</th>
                                <th colspan="2">Afternoon</th>
                            </tr>
                            <tr>
                                <th>&nbsp;</th>
                                <th>From</th>
                                <th>To</th>
                                <th>From</th>
                                <th>To</th>
                            </tr>
                        </thead>
                        <thead>
                            <tr>
                                <td>Monday</td>
                                <td>
                                    {{ form_errors(edit_form.mondayMorningFrom) }}
                                    {{ form_widget(edit_form.mondayMorningFrom, {"attr" : {"class" : "form-control", "style" : "width:100px; display: inline-block;"} }) }}
                                    
                                </td>
                                <td>    
                                    {{ form_errors(edit_form.mondayMorningTo) }}
                                    {{ form_widget(edit_form.mondayMorningTo, {"attr" : {"class" : "form-control", "style" : "width:100px; display: inline-block;"} }) }}
                                </td>
                                <td>
                                    {{ form_errors(edit_form.mondayAfternoonFrom) }}
                                    {{ form_widget(edit_form.mondayAfternoonFrom, {"attr" : {"class" : "form-control", "style" : "width:100px; display: inline-block;"} }) }}
                                </td>
                                <td>    
                                    {{ form_errors(edit_form.mondayAfternoonTo) }}
                                    {{ form_widget(edit_form.mondayAfternoonTo, {"attr" : {"class" : "form-control", "style" : "width:100px; display: inline-block;"} }) }}
                                    <a class="btn btn-default btn-sm" href="javascript:;" data-override-days="true">Apply to every day</a>
                                </td>
                            </tr>
                            <tr>
                                <td>Tuesday</td>
                                <td>
                                    {{ form_errors(edit_form.tuesdayMorningFrom) }}
                                    {{ form_widget(edit_form.tuesdayMorningFrom, {"attr" : {"class" : "form-control", "style" : "width:100px; display: inline-block;"} }) }}
                                </td>
                                <td>    
                                    {{ form_errors(edit_form.tuesdayMorningTo) }}
                                    {{ form_widget(edit_form.tuesdayMorningTo, {"attr" : {"class" : "form-control", "style" : "width:100px; display: inline-block;"} }) }}
                                </td>
                                <td>
                                    {{ form_errors(edit_form.tuesdayAfternoonFrom) }}
                                    {{ form_widget(edit_form.tuesdayAfternoonFrom, {"attr" : {"class" : "form-control", "style" : "width:100px; display: inline-block;"} }) }}
                                </td>
                                <td>    
                                    {{ form_errors(edit_form.tuesdayAfternoonTo) }}
                                    {{ form_widget(edit_form.tuesdayAfternoonTo, {"attr" : {"class" : "form-control", "style" : "width:100px; display: inline-block;"} }) }}
                                </td>
                            </tr>
                            <tr>
                                <td>Wednesday</td>
                                <td>
                                    {{ form_errors(edit_form.wednesdayMorningFrom) }}
                                    {{ form_widget(edit_form.wednesdayMorningFrom, {"attr" : {"class" : "form-control", "style" : "width:100px; display: inline-block;"} }) }}
                                </td>
                                <td>    
                                    {{ form_errors(edit_form.wednesdayMorningTo) }}
                                    {{ form_widget(edit_form.wednesdayMorningTo, {"attr" : {"class" : "form-control", "style" : "width:100px; display: inline-block;"} }) }}
                                </td>
                                <td>
                                    {{ form_errors(edit_form.wednesdayAfternoonFrom) }}
                                    {{ form_widget(edit_form.wednesdayAfternoonFrom, {"attr" : {"class" : "form-control", "style" : "width:100px; display: inline-block;"} }) }}
                                </td>
                                <td>    
                                    {{ form_errors(edit_form.wednesdayAfternoonTo) }}
                                    {{ form_widget(edit_form.wednesdayAfternoonTo, {"attr" : {"class" : "form-control", "style" : "width:100px; display: inline-block;"} }) }}
                                </td>
                            </tr>
                            <tr>
                                <td>Thursday</td>
                                <td>
                                    {{ form_errors(edit_form.thursdayMorningFrom) }}
                                    {{ form_widget(edit_form.thursdayMorningFrom, {"attr" : {"class" : "form-control", "style" : "width:100px; display: inline-block;"} }) }}
                                </td>
                                <td>    
                                    {{ form_errors(edit_form.thursdayMorningTo) }}
                                    {{ form_widget(edit_form.thursdayMorningTo, {"attr" : {"class" : "form-control", "style" : "width:100px; display: inline-block;"} }) }}
                                </td>
                                <td>
                                    {{ form_errors(edit_form.thursdayAfternoonFrom) }}
                                    {{ form_widget(edit_form.thursdayAfternoonFrom, {"attr" : {"class" : "form-control", "style" : "width:100px; display: inline-block;"} }) }}
                                </td>
                                <td>    
                                    {{ form_errors(edit_form.thursdayAfternoonTo) }}
                                    {{ form_widget(edit_form.thursdayAfternoonTo, {"attr" : {"class" : "form-control", "style" : "width:100px; display: inline-block;"} }) }}
                                </td>
                            </tr>
                            <tr>
                                <td>Friday</td>
                                <td>
                                    {{ form_errors(edit_form.fridayMorningFrom) }}
                                    {{ form_widget(edit_form.fridayMorningFrom, {"attr" : {"class" : "form-control", "style" : "width:100px; display: inline-block;"} }) }}
                                </td>
                                <td>    
                                    {{ form_errors(edit_form.fridayMorningTo) }}
                                    {{ form_widget(edit_form.fridayMorningTo, {"attr" : {"class" : "form-control", "style" : "width:100px; display: inline-block;"} }) }}
                                </td>
                                <td>
                                    {{ form_errors(edit_form.fridayAfternoonFrom) }}
                                    {{ form_widget(edit_form.fridayAfternoonFrom, {"attr" : {"class" : "form-control", "style" : "width:100px; display: inline-block;"} }) }}
                                </td>
                                <td>    
                                    {{ form_errors(edit_form.fridayAfternoonTo) }}
                                    {{ form_widget(edit_form.fridayAfternoonTo, {"attr" : {"class" : "form-control", "style" : "width:100px; display: inline-block;"} }) }}
                                </td>
                            </tr>
                            <tr>
                                <td>Saturday</td>
                                <td>
                                    {{ form_errors(edit_form.saturdayMorningFrom) }}
                                    {{ form_widget(edit_form.saturdayMorningFrom, {"attr" : {"disabled" : "disabled", "class" : "form-control", "style" : "width:100px; display: inline-block;"} }) }}
                                </td>
                                <td>    
                                    {{ form_errors(edit_form.saturdayMorningTo) }}
                                    {{ form_widget(edit_form.saturdayMorningTo, {"attr" : {"disabled" : "disabled", "class" : "form-control", "style" : "width:100px; display: inline-block;"} }) }}
                                </td>
                                <td>
                                    {{ form_errors(edit_form.saturdayAfternoonFrom) }}
                                    {{ form_widget(edit_form.saturdayAfternoonFrom, {"attr" : {"disabled" : "disabled", "class" : "form-control", "style" : "width:100px; display: inline-block;"} }) }}
                                </td>
                                <td>    
                                    {{ form_errors(edit_form.saturdayAfternoonTo) }}
                                    {{ form_widget(edit_form.saturdayAfternoonTo, {"attr" : {"disabled" : "disabled", "class" : "form-control", "style" : "width:100px; display: inline-block;"} }) }}
                                </td>
                            </tr>
                            <tr>
                                <td>Sunday</td>
                                <td>
                                    {{ form_errors(edit_form.sundayMorningFrom) }}
                                    {{ form_widget(edit_form.sundayMorningFrom, {"attr":{"disabled" : "disabled", "class" : "form-control", "style" : "width:100px; display: inline-block;"} }) }}
                                </td>
                                <td>    
                                    {{ form_errors(edit_form.sundayMorningTo) }}
                                    {{ form_widget(edit_form.sundayMorningTo, {"attr":{"disabled" : "disabled", "class" : "form-control", "style" : "width:100px; display: inline-block;"} }) }}
                                </td>
                                <td>
                                    {{ form_errors(edit_form.sundayAfternoonFrom) }}
                                    {{ form_widget(edit_form.sundayAfternoonFrom, {"attr":{"disabled" : "disabled", "class" : "form-control", "style" : "width:100px; display: inline-block;"} }) }}
                                </td>
                                <td>    
                                    {{ form_errors(edit_form.sundayAfternoonTo) }}
                                    {{ form_widget(edit_form.sundayAfternoonTo, {"attr":{"disabled" : "disabled", "class" : "form-control", "style" : "width:100px; display: inline-block;"} }) }}
                                </td>
                            </tr>
                        </thead>
                        <tfoot>
                            <tr>
                                <th colspan="3"></th>
                                <th><strong>Total time:</strong><span id="pattern-working-time"></th>
                                <th><strong>Expected time:</strong><span id="expected-working-time">{{ entity.patternForUser.weeklyHoursToBeDone(true) }}</th>
                            </tr>
                        </tfoot>
                        </table>

                        {{ form_widget(edit_form) }}
                        

                        <div class="form-actions">
                            <input id="submit-button" type="submit" class="btn btn-primary" />
                        </div>
                    {{ form_end(edit_form) }}
                    </div>
                </div>
            </div>
        </div>
    </div>

{% endblock %}

{% block specificJs %}{{ parent() }}
    <script src="https://code.jquery.com/jquery-3.6.1.min.js"></script>
    <script src="/moment.min.js"></script>
    <script>
        $(function() {
            
            $("[data-override-days]").on("click", function() {
                $("#working_sheet_pattern_tuesdayMorningFrom").val($("#working_sheet_pattern_mondayMorningFrom").val());
                $("#working_sheet_pattern_tuesdayMorningTo").val($("#working_sheet_pattern_mondayMorningTo").val());
                $("#working_sheet_pattern_tuesdayAfternoonFrom").val($("#working_sheet_pattern_mondayAfternoonFrom").val());
                $("#working_sheet_pattern_tuesdayAfternoonTo").val($("#working_sheet_pattern_mondayAfternoonTo").val());
                
                $("#working_sheet_pattern_wednesdayMorningFrom").val($("#working_sheet_pattern_mondayMorningFrom").val());
                $("#working_sheet_pattern_wednesdayMorningTo").val($("#working_sheet_pattern_mondayMorningTo").val());
                $("#working_sheet_pattern_wednesdayAfternoonFrom").val($("#working_sheet_pattern_mondayAfternoonFrom").val());
                $("#working_sheet_pattern_wednesdayAfternoonTo").val($("#working_sheet_pattern_mondayAfternoonTo").val());
                
                $("#working_sheet_pattern_thursdayMorningFrom").val($("#working_sheet_pattern_mondayMorningFrom").val());
                $("#working_sheet_pattern_thursdayMorningTo").val($("#working_sheet_pattern_mondayMorningTo").val());
                $("#working_sheet_pattern_thursdayAfternoonFrom").val($("#working_sheet_pattern_mondayAfternoonFrom").val());
                $("#working_sheet_pattern_thursdayAfternoonTo").val($("#working_sheet_pattern_mondayAfternoonTo").val());
                
                $("#working_sheet_pattern_fridayMorningFrom").val($("#working_sheet_pattern_mondayMorningFrom").val());
                $("#working_sheet_pattern_fridayMorningTo").val($("#working_sheet_pattern_mondayMorningTo").val());
                $("#working_sheet_pattern_fridayAfternoonFrom").val($("#working_sheet_pattern_mondayAfternoonFrom").val());
                $("#working_sheet_pattern_fridayAfternoonTo").val($("#working_sheet_pattern_mondayAfternoonTo").val());
                updatePatternDuration();
                
            });
            
            var updatePatternDuration = function() {
                var from = null;
                var to = null;
                var duration = moment.duration();

                from = moment(moment().format("YYYY-MM-DD")+ " " + $("#working_sheet_pattern_mondayMorningFrom").val() + ":00");
                to = moment(moment().format("YYYY-MM-DD")+ " " + $("#working_sheet_pattern_mondayMorningTo").val() + ":00");

                if (from.isValid() && to.isValid()) {
                   duration.add(moment.duration(from.diff(to)));
                }

                from = moment(moment().format("YYYY-MM-DD")+ " " + $("#working_sheet_pattern_mondayAfternoonFrom").val() + ":00");
                to = moment(moment().format("YYYY-MM-DD")+ " " + $("#working_sheet_pattern_mondayAfternoonTo").val() + ":00");

                if (from.isValid() && to.isValid()) {
                   duration.add(moment.duration(from.diff(to)));
                }


                from = moment(moment().format("YYYY-MM-DD")+ " " + $("#working_sheet_pattern_tuesdayMorningFrom").val() + ":00");
                to = moment(moment().format("YYYY-MM-DD")+ " " + $("#working_sheet_pattern_tuesdayMorningTo").val() + ":00");

                if (from.isValid() && to.isValid()) {
                   duration.add(moment.duration(from.diff(to)));
                }

                from = moment(moment().format("YYYY-MM-DD")+ " " + $("#working_sheet_pattern_tuesdayAfternoonFrom").val() + ":00");
                to = moment(moment().format("YYYY-MM-DD")+ " " + $("#working_sheet_pattern_tuesdayAfternoonTo").val() + ":00");

                if (from.isValid() && to.isValid()) {
                   duration.add(moment.duration(from.diff(to)));
                }

                from = moment(moment().format("YYYY-MM-DD")+ " " + $("#working_sheet_pattern_wednesdayMorningFrom").val() + ":00");
                to = moment(moment().format("YYYY-MM-DD")+ " " + $("#working_sheet_pattern_wednesdayMorningTo").val() + ":00");

                if (from.isValid() && to.isValid()) {
                   duration.add(moment.duration(from.diff(to)));
                }

                from = moment(moment().format("YYYY-MM-DD")+ " " + $("#working_sheet_pattern_wednesdayAfternoonFrom").val() + ":00");
                to = moment(moment().format("YYYY-MM-DD")+ " " + $("#working_sheet_pattern_wednesdayAfternoonTo").val() + ":00");

                if (from.isValid() && to.isValid()) {
                   duration.add(moment.duration(from.diff(to)));
                }

                from = moment(moment().format("YYYY-MM-DD")+ " " + $("#working_sheet_pattern_thursdayMorningFrom").val() + ":00");
                to = moment(moment().format("YYYY-MM-DD")+ " " + $("#working_sheet_pattern_thursdayMorningTo").val() + ":00");

                if (from.isValid() && to.isValid()) {
                   duration.add(moment.duration(from.diff(to)));
                }

                from = moment(moment().format("YYYY-MM-DD")+ " " + $("#working_sheet_pattern_thursdayAfternoonFrom").val() + ":00");
                to = moment(moment().format("YYYY-MM-DD")+ " " + $("#working_sheet_pattern_thursdayAfternoonTo").val() + ":00");

                if (from.isValid() && to.isValid()) {
                   duration.add(moment.duration(from.diff(to)));
                }

                from = moment(moment().format("YYYY-MM-DD")+ " " + $("#working_sheet_pattern_fridayMorningFrom").val() + ":00");
                to = moment(moment().format("YYYY-MM-DD")+ " " + $("#working_sheet_pattern_fridayMorningTo").val() + ":00");

                if (from.isValid() && to.isValid()) {
                   duration.add(moment.duration(from.diff(to)));
                }

                from = moment(moment().format("YYYY-MM-DD")+ " " + $("#working_sheet_pattern_fridayAfternoonFrom").val() + ":00");
                to = moment(moment().format("YYYY-MM-DD")+ " " + $("#working_sheet_pattern_fridayAfternoonTo").val() + ":00");

                if (from.isValid() && to.isValid()) {
                   duration.add(moment.duration(from.diff(to)));
                }

                from = moment(moment().format("YYYY-MM-DD")+ " " + $("#working_sheet_pattern_saturdayMorningFrom").val() + ":00");
                to = moment(moment().format("YYYY-MM-DD")+ " " + $("#working_sheet_pattern_saturdayMorningTo").val() + ":00");

                if (from.isValid() && to.isValid()) {
                   duration.add(moment.duration(from.diff(to)));
                }

                from = moment(moment().format("YYYY-MM-DD")+ " " + $("#working_sheet_pattern_saturdayAfternoonFrom").val() + ":00");
                to = moment(moment().format("YYYY-MM-DD")+ " " + $("#working_sheet_pattern_saturdayAfternoonTo").val() + ":00");

                if (from.isValid() && to.isValid()) {
                   duration.add(moment.duration(from.diff(to)));
                }

                from = moment(moment().format("YYYY-MM-DD")+ " " + $("#working_sheet_pattern_sundayMorningFrom").val() + ":00");
                to = moment(moment().format("YYYY-MM-DD")+ " " + $("#working_sheet_pattern_sundayMorningTo").val() + ":00");

                if (from.isValid() && to.isValid()) {
                   duration.add(moment.duration(from.diff(to)));
                }

                from = moment(moment().format("YYYY-MM-DD")+ " " + $("#working_sheet_pattern_sundayAfternoonFrom").val() + ":00");
                to = moment(moment().format("YYYY-MM-DD")+ " " + $("#working_sheet_pattern_sundayAfternoonTo").val() + ":00");

                if (from.isValid() && to.isValid()) {
                   duration.add(moment.duration(from.diff(to)));
                }

                var hours = Math.abs(duration.days() * 24) + Math.abs(duration.hours());
                $("#pattern-working-time").text(hours + "h" + Math.abs(duration.minutes()).toString().padStart(2, "0"));
            };
            
            updatePatternDuration();
            
            $("body").on("change", "input", function() {
                updatePatternDuration();
            });
            
            var patternFormAcceptSubmit = false;
            $("#pattern-form").on("submit", function(e) {
                if (patternFormAcceptSubmit) {
                    return true;
                } 
                
                e.preventDefault();
                
                if ($("#pattern-working-time").text() !== $("#expected-working-time").text()) {
                    bootbox.confirm("The pattern working time <strong>(" + $("#pattern-working-time").text() + ")</strong> is different from the expected weekly hours you are supposed to do <strong>(" + $("#expected-working-time").text() + ")</strong>. Do you want to send your pattern to the HR anyway ?", function(accepted) {
                        if (accepted) {
                            patternFormAcceptSubmit = true;
                            $("#pattern-form").submit();
                        } 
                    });
                } else {
                    patternFormAcceptSubmit = true;
                    $("#pattern-form").submit();
                }
            });
            
        });
    </script>
    
{% endblock specificJs %}